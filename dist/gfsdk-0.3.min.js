/*! GAMIFIVE SDK - v0.3 - 25-11-2014
* http://gamifive.com/
* Copyright (c) 2014 Gamifive; Licensed MIT */

!function(a){function b(){var a,b={version:"0.3.1",contentId:""};Object.defineProperty(b,"dom",{get:function(){return a||(a=document.querySelector("#gfsdk_root")||e()),a},set:function(c){return!c&&a?(document.body.removeChild(a),a=null):c&&(b.dom.innerHTML=c),a}});var e=function(){var a=document.createElement("div");a.id="gfsdk_root",document.body.appendChild(a);var b=function(a){a.stopPropagation()};a.addEventListener("touchmove",b),a.addEventListener("touchstart",b),a.addEventListener("touchend",b);var c="http://s2.motime.com/js/wl/webstore_html5game/gameover.js",d=document.createElement("script");return d.src=c,k.debugMode||a.appendChild(d),a},f=function(a,d){var e=c().querify(d),f={canDownload:k.debugMode?"user.candownload":"user.candownload/"+b.contentId,gameover:k.debugMode?"gameover":"gameover/"+b.contentId,paywall:k.debugMode?"gameoverpaywall":"gameoverpaywall"+b.contentId,userInfo:k.debugMode?"user.lightinfo":"user.lightinfo",updateCredits:k.debugMode?"mipuser.updatecredits":"mipuser.updatecredits",gamifiveInfo:k.debugMode?"GamifiveInfo":null,newChallenge:k.debugMode?"challenge.post":"challenge.post",mipConnect:k.debugMode?"mipuser.fbconnect":"mipuser.fbconnect"};return k.debugMode?c().getAbsoluteUrl()+"/mock01/"+f[a]:"/v01/"+f[a]+e},g=function(){var a=window.GamifiveInfo;k.debugMode=c().getScriptParams().debug,"undefined"==typeof a&&k.debugMode?c().xhr("GET",f("gamifiveInfo"),function(a,b){b.response&&(window.GamifiveInfo=a),g()}):"undefined"!=typeof a||k.debugMode||console.warn("No GamifiveInfo found. Set add ?debug=true if you are debugging."),"object"==typeof a&&(c().copyProperties(a,b),d.setConfig("appId",b.fbAppId),d.start(),c().xhr("GET",f("userInfo"),function(a,c){c.response&&(b.user=a)}),k.logEnabled&&console.log("GamefiveSDK->init",b))};this.updateConfig=function(a){return a&&"object"==typeof a||(a={logEnabled:!1,httpEnabled:!0,debugMode:!1,startCallback:null,eventCallback:{}}),c().copyProperties(a,k),c().xhrDisabled=!k.httpEnabled,k.logEnabled&&console.log("GamefiveSDK","updateConfig",k),k},this.startSession=function(){function a(){if(k.logEnabled&&console.log("startSession callback now"),b.dom=null,!k.startCallback)throw new Error("No startSession callback found. use GamefiveSDK.onStartSession(callback) to define one before calling the startSession() method");k.startCallback.call()}k.logEnabled&&console.log("GamefiveSDK.startSession",arguments),b.timestart=Date.now(),k.debugMode&&!k.httpEnabled&&a(),c().xhr("GET",f("canDownload"),function(b,d){k.logEnabled&&console.log("API::canDownload",b.canDownload,d),b.canDownload?a():c().xhr("GET",f("gameover"),function(a){i(a),h("user_no_credits")})})},this.onStartSession=function(a){k.logEnabled&&console.log("GamefiveSDK.onStartSession",k),k.startCallback=a},this.onEvent=function(a,b){if(k.logEnabled&&console.log("GamefiveSDK.onEvent",a),a instanceof Array)for(var c=0;c<a.length;c++)k.eventCallback[a[c]]=b;else k.eventCallback[a]=b};var h=function(a,b){k.eventCallback[a]&&k.eventCallback[a].call(this,b)};this.endSession=function(a){k.logEnabled&&console.log("GamefiveSDK.endSession",a),b.timeend=Date.now(),b.score=parseFloat(a.score)||0;var d=b.challenge?b.challenge.id:null,e={start:b.timestart,duration:b.timeend-b.timestart,score:b.score,challenge_id:d};c().xhr("GET",f("gameover",e),i)};var i=function(a){k.logEnabled&&console.log("render",{da:a}),b.dom=a};this.status=function(){return b};var j=function(){var a=window.GamifiveInfo.dictionary.messageOfFbChallenge;a=a.replace("%s",b.score);var e={score:b.score,contentId:b.contentId,userId:b.userId,message:a};d.invite(e,function(a){if(a)if(a.to.length){h("fb_invite_success",a);var d={fbusers_id:a.to||null,userId:b.userId||null};c().xhr("GET",f("updateCredits",d),function(a){h("user_credits_updated",a)})}else h("fb_invite_empty",a);else h("fb_invite_error",a)})};this.challenge=function(a){var d={content_id:b.contentId,challenger_id:b.userId,challenged_id:a,challenger_score:b.score};h("challenge_request",a),c().xhr("GET",f("newChallenge",d),function(a){h("challenge_completed",a)})},this.invite=function(){!b.requireFbConnect&&b.fbConnected?j():b.requireFbConnect&&!b.fbExternal?d.login(function(a){"connected"===a.status?c().xhr("GET",f("mipConnect",{access_token:a.authResponse.accessToken}),function(a,b){200==parseInt(b.status)?j():h("user_fbconnect_fail",a)}):"not_authorized"===a.status?h("fb_login_noauth",a):h("fb_login_fail",a)}):b.requireFbConnect&&b.fbExternal&&(document.location.href=b.fbExternal)};var k={};this.updateConfig(),g()}var c=function(){return this.xhrDisabled=!1,Date.now||(Date.now=function(){return(new Date).getTime()}),this.copyProperties=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},this.getScriptParams=function(){var a=document.querySelector("#gfsdk");if(!a)return{};var b=a.src.replace(/^[^\?]+\??/,""),c=this.dequerify(b);return c},this.cookie={get:function(a){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},set:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},remove:function(a,b,c){return a&&this.has(a)?(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0):!1},has:function(a){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},this.getAbsoluteUrl=function(){var a=window.location.href.split("/");return a.splice(a.length-1),a.join("/")},this.xhr=function(){return function(a,b,c){if(this.xhrDisabled)return!0;var d=new XMLHttpRequest;return d.onreadystatechange=function(){if(4===d.readyState){var a;try{a=d.response.replace(/(\r\n|\n|\r)/gm,""),a=JSON.parse(a)}catch(b){}a.success=d.status<=399||d.status>=200,c&&c(a,d)}},d.open(a,b),d.send(),d}}(),this.querify=function(a){if(!a)return"";var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return"?"+b.join("&")},this.dequerify=function(a){var b=new Object;if(!a)return b;a=a.replace("?","");for(var c=a.split(/[;&]/),d=0;d<c.length;d++){var e=c[d].split("=");if(e&&2==e.length){var f=unescape(e[0]),g=unescape(e[1]);g=g.replace(/\+/g," "),b[f]=g}}return b},arguments.callee._instance||(arguments.callee._instance=this),arguments.callee._instance},d=function(){function a(a){"connected"===a.status?(d(),f.onLogged.call(this,a)):"not_authorized"===a.status?(console.log("Please log into this app."),f.autoLogin&&b()):(console.log("Please auth this app."),f.autoLogin&&b())}function b(a){var b=document.body.clientWidth>600?"popup":"touch";FB.login(function(b){b.authResponse?(console.log("Welcome!  Fetching your information.... "),a.call(this,b)):(a.call(this,b),console.log("User cancelled login or did not fully authorize."))},{scope:"user_friends",display:b})}function c(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}function d(){console.log("Welcome!  Fetching your information.... "),FB.api("/me",function(a){console.log("Successful login for: "+a.name),console.log(a)})}var e=[],f={appId:"",autoLogin:!1,autoStart:!1,onLogged:function(){}},g=function(a){if(e.length>0)return e;var c=0,d=function(d){d&&!d.error?(c++,e=e.concat(d.data),c>1&&a(e)):b(FB.inviteFriends)};FB.api("/me/invitable_friends",d),FB.api("/me/friends",d)};window.fbAsyncInit=function(){FB.init({appId:f.appId,cookie:!0,xfbml:!1,version:"v2.1"}),FB.getLoginStatus(function(b){a(b)})};var h=function(a,b){FB.ui({method:"apprequests",message:a.message,data:JSON.stringify(a)},b)};return{start:c,login:b,invite:h,getFriends:g,setConfig:function(a,b){void 0!=f[a]&&(f[a]=b)}}}();a.GamefiveSDK=new b}(window);
//# sourceMappingURL=gfsdk-0.3.min.js.map