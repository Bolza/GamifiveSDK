/*! GAMIFIVE SDK - v0.3 - 29-10-2014
* http://gamifive.com/
* Copyright (c) 2014 Gamifive; Licensed MIT */
!function(a){function b(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return"?"+b.join("&")}function c(){var a={},c={logEnabled:!1,httpEnabled:!0,debugMode:!0,startCallback:null},f={canDownload:"/v01/user.candownload/",leaderboard:"/v01/leaderboard/",userInfo:"/v01/user.lightinfo/"},g=window.location.search.toLowerCase().indexOf("fbstart"),h=window.location.search.toLowerCase().indexOf("fblogin"),i=window.GamefiveInfo||null,j=function(){!i&&c.debugMode&&(i={}),a.userId=i.userid,a.label=i.logEnabled,a.appId=i.contentId||window.location.pathname.split("/")[4]||null,a.fbAppId=i.fbAppId;var b=new e;(g||h)&&b.start(),d("GET",f.userInfo,function(b,c){c.response&&(a.user=b)}),c.logEnabled&&console.log("GamefiveSDK->init",a)};this.updateConfig=function(a){"object"!=typeof a&&(a={}),c.logEnabled=a.logEnabled||c.logEnabled,c.httpEnabled=a.httpEnabled||c.httpEnabled,c.debugMode=a.debugMode||c.debugMode,c.startCallback=a.startCallback||c.startCallback},this.startSession=function(){function b(){if(!c.startCallback)throw new Error("No startSession callback found. use GamefiveSDK.onStartSession(callback) to define one before calling the startSession() method");c.startCallback.call()}c.logEnabled&&console.log("GamefiveSDK.startSession",arguments),a.timestart=Date.now(),d("GET",f.canDownload+a.userId,function(a,d){console.log("XHR what happened",a,d),d.response||d.status||!c.debugMode||(a={canDownload:!0}),a.canDownload?(console.log(" call_start_callback "),b()):console.log(" GameOver special ")})},this.onStartSession=function(a){c.startCallback=a},this.endSession=function(e){c.logEnabled&&console.log("GamefiveSDK.endSession",arguments),a.timeend=Date.now();var g=b({newapps:1,appId:a.appId,label:a.label,userId:a.userId,start:a.timestart,duration:a.timeend-a.timestart,score:parseFloat(e.score)||0});c.httpEnabled&&d("GET",f.leaderboard+g)},this.status=function(){return a},this.fbInvite=function(){d("GET","https://graph.facebook.com/me/friends",function(a){console.log(a)})},j()}Date.now||(Date.now=function(){return(new Date).getTime()});var d=function(){return function(a,b,c){var d=new XMLHttpRequest;return d.onreadystatechange=function(){4===d.readyState&&c&&c(d.responseText,d)},d.open(a,b),d.send(),d}}(),e=function(){function a(a){"connected"===a.status?d():"not_authorized"===a.status?(console.log("Please log into this app."),f.autoLogin&&b()):(console.log("Please auth this app."),f.autoLogin&&b())}function b(a){var b=document.body.clientWidth>600?"popup":"touch";FB.login(function(b){b.authResponse?(console.log("Welcome!  Fetching your information.... "),a&&a.call(this)):console.log("User cancelled login or did not fully authorize.")},{scope:"user_friends",display:b})}function c(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}function d(){console.log("Welcome!  Fetching your information.... "),FB.api("/me",function(a){console.log("Successful login for: "+a.name),console.log(a)})}var e=[],f={appId:"218613018316690",autoLogin:!1,autoStart:!1},g=function(a){if(e.length>0)return e;var c=0,d=function(d){d&&!d.error?(e=e.concat(d.data),c>1&&a(e)):b(FB.inviteFriends)};FB.api("/me/invitable_friends",d),FB.api("/me/friends",d)};return window.fbAsyncInit=function(){FB.init({appId:f.appId,cookie:!0,xfbml:!1,version:"v2.1"}),FB.getLoginStatus(function(b){a(b)}),FB.inviteFriends=function(a){function b(a){var b=document.body,d=document.createElement("form");d.id="mfsForm";for(var e=0;e<Math.min(a.length,10);e++){var f=document.createElement("div");f.id="friend_"+a[e].id,f.innerHTML='<input type="checkbox" name="friends" value="'+a[e].id+'" />'+a[e].name,d.appendChild(f)}b.appendChild(d);var g=document.createElement("input");g.type="button",g.value="Send Request",g.onclick=c,d.appendChild(g)}function c(){for(var b="",c=document.getElementById("mfsForm"),d=0;d<c.friends.length;d++)c.friends[d].checked&&(b+=c.friends[d].value+",");FB.ui({method:"apprequests",to:b,title:"Play with me on Gamefive",message:"My score is "+a.score+", try to beat me! Play gratis on Gamefive.",data:JSON.stringify(a)},function(a){console.log(a)})}g(b)}},{start:c,login:b,getFriends:g,appId:f.appId,autoLogin:f.autoLogin,autoStart:f.autoStart}};a.GamefiveSDK=new c}(window);