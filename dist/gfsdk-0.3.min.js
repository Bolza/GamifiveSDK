/*! GAMIFIVE SDK - v0.3 - 03-11-2014
* http://gamifive.com/
* Copyright (c) 2014 Gamifive; Licensed MIT */
!function(a){function b(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return"?"+b.join("&")}function c(){var a,c={};Object.defineProperty(c,"dom",{get:function(){return a||(a=document.querySelector("#gfsdk_root")||f()),a},set:function(b){return c.dom&&(a.innerHTML=b),a}});var f=function(){var a=document.createElement("div");return a.id="gfsdk_root",a.style.position="absolute",a.style.width="100%",a.style.height="100%",a.style.top="0",a.style.left="0",a.style.background="white",document.body.appendChild(a),a},g={logEnabled:!1,httpEnabled:!0,debugMode:!0,startCallback:null},h={canDownload:"/v01/user.candownload/",leaderboard:"/v01/leaderboard/",userInfo:"/v01/user.lightinfo/",gameover:"/v01/gameover/",updateCredits:"/v01/mipuser.updatecredits"},i=window.location.search.toLowerCase().indexOf("fbstart"),j=window.location.search.toLowerCase().indexOf("fblogin"),k=function(){!GamefiveInfo&&g.debugMode&&(GamefiveInfo={}),c.userId=GamefiveInfo.userId,c.label=GamefiveInfo.logEnabled,c.appId=GamefiveInfo.contentId||window.location.pathname.split("/")[4]||null,c.fbAppId=GamefiveInfo.fbAppId;var a=new e;(i||j)&&a.start(),d("GET",h.userInfo,function(a,b){b.response&&(c.user=a)}),g.logEnabled&&console.log("Game9fiveSDK->init",c)};this.updateConfig=function(a){"object"!=typeof a&&(a={}),g.logEnabled=a.logEnabled||g.logEnabled,g.httpEnabled=a.httpEnabled||g.httpEnabled,g.debugMode=a.debugMode||g.debugMode,g.startCallback=a.startCallback||g.startCallback},this.startSession=function(){function a(){if(!g.startCallback)throw new Error("No startSession callback found. use GamefiveSDK.onStartSession(callback) to define one before calling the startSession() method");g.startCallback.call()}g.logEnabled&&console.log("GamefiveSDK.startSession",arguments),c.timestart=Date.now(),d("GET",h.canDownload+c.userId,function(b,c){console.log("XHR what happened",b,c),c.response||c.status||!g.debugMode||(b={canDownload:!0}),b.canDownload?(console.log(" call_start_callback "),a()):console.log(" GameOver fail ",b,c)})},this.onStartSession=function(a){g.startCallback=a},this.endSession=function(a){g.logEnabled&&console.log("GamefiveSDK.endSession",arguments),c.timeend=Date.now(),c.score=parseFloat(a.score)||0;var e=b({start:c.timestart,duration:c.timeend-c.timestart,score:c.score});g.httpEnabled&&d("GET",h.gameover+c.userId+e,l)};var l=function(a){console.log("render",{da:a}),c.dom=a};this.status=function(){return c},this.invite=function(){FB.invite(c,function(a){console.log("FB.invite resp",a);var c=b({fbusers_id:a.to});g.httpEnabled&&d("GET",h.updateCredits+c)})},k()}Date.now||(Date.now=function(){return(new Date).getTime()});var d=function(){return function(a,b,c){var d=new XMLHttpRequest;return d.onreadystatechange=function(){4===d.readyState&&c&&c(d.responseText,d)},d.open(a,b),d.send(),d}}(),e=function(){function a(a){"connected"===a.status?d():"not_authorized"===a.status?(console.log("Please log into this app."),f.autoLogin&&b()):(console.log("Please auth this app."),f.autoLogin&&b())}function b(a){var b=document.body.clientWidth>600?"popup":"touch";FB.login(function(b){b.authResponse?(console.log("Welcome!  Fetching your information.... "),a&&a.call(this)):console.log("User cancelled login or did not fully authorize.")},{scope:"user_friends",display:b})}function c(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}function d(){console.log("Welcome!  Fetching your information.... "),FB.api("/me",function(a){console.log("Successful login for: "+a.name),console.log(a)})}var e=[],f={appId:"218613018316690",autoLogin:!1,autoStart:!1},g=function(a){if(e.length>0)return e;var c=0,d=function(d){d&&!d.error?(c++,e=e.concat(d.data),c>1&&a(e)):b(FB.inviteFriends)};FB.api("/me/invitable_friends",d),FB.api("/me/friends",d)};return window.fbAsyncInit=function(){FB.init({appId:f.appId,cookie:!0,xfbml:!1,version:"v2.1"}),FB.getLoginStatus(function(b){a(b)}),FB.invite=function(a,b){FB.ui({method:"apprequests",message:"My score is "+a.score+", try to beat me! Play gratis on Gamefive."},b)}},{start:c,login:b,getFriends:g,appId:f.appId,autoLogin:f.autoLogin,autoStart:f.autoStart}};a.GamefiveSDK=new c}(window);