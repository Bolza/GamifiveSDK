/*! GAMIFIVE SDK - v0.3 - 20-10-2014
* http://gamifive.com/
* Copyright (c) 2014 Gamifive; Licensed MIT */
!function(){function a(){function a(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return"?"+b.join("&")}var b={},c={logEnabled:!1,httpEnabled:!0,debugMode:!0,startCallback:null},d={canDownload:"/v01/user.candownload/",leaderboard:"/v01/leaderboard/",userInfo:"/v01/user.lightinfo/"};Date.now||(Date.now=function(){return(new Date).getTime()});var e=function(){return function(a,b,c){var d=new XMLHttpRequest;return d.onreadystatechange=function(){4===d.readyState&&c&&c(d.responseText,d)},d.open(a,b),d.send(),d}}(),f=window.GamefiveInfo||null,g=function(){!f&&c.debugMode&&(f={}),b.userId=f.userid||"userid-not-found",b.label=f.label||"label-not-found",b.appId=f.contentId||window.location.pathname.split("/")[4]||null,b.fbAppId=f.fbAppId,e("GET",d.userInfo,function(a,c){c.response&&(b.user=a)}),c.logEnabled&&console.log("GamefiveSDK->init",b)};this.updateConfig=function(a){"object"!=typeof a&&(a={}),c.logEnabled=a.logEnabled||c.logEnabled,c.httpEnabled=a.httpEnabled||c.httpEnabled,c.debugMode=a.debugMode||c.debugMode,c.startCallback=a.startCallback||c.startCallback},this.startSession=function(){function a(){if(!c.startCallback)throw new Error("No startSession callback found. use GamefiveSDK.onStartSession(callback) to define one before calling the startSession() method");c.startCallback.call()}c.logEnabled&&console.log("GamefiveSDK.startSession",arguments),b.timestart=Date.now(),e("GET",d.canDownload+b.userId,function(b,d){console.log("XHR what happened",b,d),d.response||d.status||!c.debugMode||(b={canDownload:!0}),b.canDownload?(console.log(" call_start_callback "),a()):console.log(" GameOver special ")})},this.onStartSession=function(a){c.startCallback=a},this.endSession=function(f){c.logEnabled&&console.log("GamefiveSDK.endSession",arguments),b.timeend=Date.now();var g=a({newapps:1,appId:b.appId,label:b.label,userId:b.userId,start:b.timestart,duration:b.timeend-b.timestart,score:parseFloat(f.score)||0});c.httpEnabled&&e("GET",d.leaderboard+g)},this.status=function(){return b},this.fbInvite=function(){e("GET","https://graph.facebook.com/me/friends",function(a){console.log(a)})},g()}!function(){function a(a){"connected"===a.status?d():console.log("not_authorized"===a.status?"Please log into this app.":"Please auth this app.")}function b(a){var b=document.body.clientWidth>600?"popup":"touch";FB.login(function(b){b.authResponse?(console.log("Welcome!  Fetching your information.... "),a&&a.call(this)):console.log("User cancelled login or did not fully authorize.")},{scope:"user_friends",display:b})}function c(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}function d(){console.log("Welcome!  Fetching your information.... "),FB.api("/me",function(a){console.log("Successful login for: "+a.name),console.log(a)})}window.fbAsyncInit=function(){function c(a){var b=document.body,c=document.createElement("form");c.id="mfsForm";for(var e=0;e<Math.min(a.data.length,10);e++){var f=document.createElement("div");f.id="friend_"+a.data[e].id,f.innerHTML='<input type="checkbox" name="friends" value="'+a.data[e].id+'" />'+a.data[e].name,c.appendChild(f)}b.appendChild(c);var g=document.createElement("input");g.type="button",g.value="Send Request",g.onclick=d,c.appendChild(g)}function d(){for(var a="",b=document.getElementById("mfsForm"),c=0;c<b.friends.length;c++)b.friends[c].checked&&(a+=b.friends[c].value+",");FB.ui({method:"apprequests",to:a,title:"My Great Invite",message:"Check out this Awesome App!"},function(a){console.log(a)})}FB.init({appId:"218613018316690",cookie:!0,xfbml:!1,version:"v2.1"}),FB.inviteFriends=function(){FB.api("/me/invitable_friends",function(a){a&&!a.error?(console.log("invitable_friends",a),c(a)):(console.log("invitable_friends error",a),b(FB.inviteFriends))})},FB.getLoginStatus(function(b){a(b)})},window.location.search.toLowerCase().indexOf("fbstart")>-1&&c()}();window.GamefiveSDK=new a}(window);