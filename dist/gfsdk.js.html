<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gfsdk.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: gfsdk.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>	/**
	* Main SDK Class
	* @class
	* Minified Source CDN: {@link http://bgames2.mobivillage.com/utility/gamesdk/dist/gfsdk-0.1.min.js}
	* @tutorial {@link http://bgames2.mobivillage.com/utility/gamesdk/dist/GamefiveSDK.html}
	* @author Stefano Sergio
	* @param {boolean} [autoInit=false] - if TRUE the constructor calls init function at startup
	*/
	function GamefiveSDK(autoInit) {
		var mipId, appId, userId, label;
		var sessionData = {};
		var currentConf = {
			logEnabled: false, 
			httpEnabled: true
		};

		if (!Date.now) {
	    	Date.now = function() { return new Date().getTime() };
		}

		var cookie = {
			get: function (sKey) {
				return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, "\\$&amp;") + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) || null;
			},
			set: function (sKey, sValue, vEnd, sPath, sDomain, bSecure) {
				if (!sKey || /^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)) { return false; }
				var sExpires = "";
				if (vEnd) {
					switch (vEnd.constructor) {
						case Number:
						sExpires = vEnd === Infinity ? "; expires=Fri, 31 Dec 9999 23:59:59 GMT" : "; max-age=" + vEnd;
						break;
						case String:
						sExpires = "; expires=" + vEnd;
						break;
						case Date:
						sExpires = "; expires=" + vEnd.toUTCString();
						break;
					}
				}
				document.cookie = encodeURIComponent(sKey) + "=" + encodeURIComponent(sValue) + sExpires + (sDomain ? "; domain=" + sDomain : "") + (sPath ? "; path=" + sPath : "") + (bSecure ? "; secure" : "");
				return true;
			},
			remove: function (sKey, sPath, sDomain) {
				if (!sKey || !this.has(sKey)) { return false; }
				document.cookie = encodeURIComponent(sKey) + "=; expires=Thu, 01 Jan 1970 00:00:00 GMT" + ( sDomain ? "; domain=" + sDomain : "") + ( sPath ? "; path=" + sPath : "");
				return true;
			},
			has: function (sKey) {
				return (new RegExp("(?:^|;\\s*)" + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, "\\$&amp;") + "\\s*\\=")).test(document.cookie);
			},
			keys: /* optional method: you can safely remove it! */ function () {
				var aKeys = document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g, "").split(/\s*(?:\=[^;]*)?;\s*/);
				for (var nIdx = 0; nIdx &lt; aKeys.length; nIdx++) { aKeys[nIdx] = decodeURIComponent(aKeys[nIdx]); }
					return aKeys;
			}
		};

		var xhr = function() {
		    return function( method, url, callback ) {
		    	var xhr = new XMLHttpRequest();
		        xhr.onreadystatechange = function() {
		            if ( xhr.readyState === 4 ) {
		                if (callback) callback( xhr.responseText );
		            }
		        };
		        xhr.open( method, url );
		        xhr.send();
		        return xhr;
		    };
		}();

		function generateUID() {
			var d = new Date().getTime();
			var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
				var r = (d + Math.random()*16)%16 | 0;
				d = Math.floor(d/16);
				return (c=='x' ? r : (r&amp;0x7|0x8)).toString(16);
			});
			return uuid;
		}

		function querify(obj) {
			var str = [];
			for(var p in obj) {
				if (obj.hasOwnProperty(p)) str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
			}
			return '?'+str.join("&amp;");
		}

		var getAdditionalInfo = window.getAdditionalInfo || function() { return {} };

		/**
		* Initialize the SDK with current data
		* @param {object} [confObject] - Configuration object
		* @param {boolean} [confObject.logEnabled=false] - Logging state, only for debug
		* @param {boolean} [confObject.httpEnabled=true] - Enable/Disable xhr calls, should always be TRUE
		*/
		this.init = function(confObj) {
			currentConf.logEnabled = confObj.logEnabled || currentConf.logEnabled;
			currentConf.httpEnabled = confObj.httpEnabled || currentConf.httpEnabled;
			sessionData.sessionId = generateUID();
			sessionData.userId = getAdditionalInfo().userid;
			sessionData.label = getAdditionalInfo().label;
			sessionData.appId = window.location.pathname.split('/')[4];
			if (currentConf.logEnabled) console.log('GamefiveSDK.init', arguments);
		}

		/**
		* Define the start of a session, where a session should be a continued user activity delimitated by a user interaction
		* like a game match. Init must be called first or autoInit must be TRUE.
		*/
		this.startSession = function() {
			if (currentConf.logEnabled) console.log('GamefiveSDK.startSession', arguments);
			sessionData.timestart = Date.now();
		}
		
		/**
		* Define the end of a session. startSession must be called first.
		* @param {object} [endingParams] - Some parameters can be sent inside an object to enrich the user statistics.
		* @param {object} endingParams.score - User score for the ended session.
		*/	
		this.endSession = function(endingParams) {
			if (currentConf.logEnabled) console.log('GamefiveSDK.endSession', arguments);
			sessionData.timeend = Date.now();
			var querystring = querify({ 
				'newapps': 1,
				'appId': sessionData.appId,
				'label': sessionData.label,
				'userId': sessionData.userId,
				'start': sessionData.timestart,
				'duration': sessionData.timeend - sessionData.timestart,
				'score': parseFloat(endingParams.score) || 0
			});
			
			if (currentConf.httpEnabled) xhr('GET', '/leaderboard'+querystring);
		}

		/**
		* Get SDK Status and Data 
		* @returns {Object} Object containing Session and User Information
		*/
		this.status = function() {
			return sessionData;
		}

		if (autoInit) this.init(currentConf); 
	}


	window.GamefiveSDK = new GamefiveSDK(true);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="GamefiveSDK.html">GamefiveSDK</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Tue Sep 16 2014 11:47:46 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
