<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: session/session.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: session/session.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>
var Logger   = require('../logger/logger');
var Newton   = require('../newton/newton');
var GA       = require('../ga/ga');
var VHost    = require('../vhost/vhost');
var Network  = require('../network/network');
var Menu     = require('../menu/menu');
var Location = require('../location/location');

/**
* Session module
* @namespace Session
* @version 0.9
*/
var Session = new function(){

    var sessionInstance = this;

    var startCallback;

    var config;

    /**
    * resets the internal configuration to default value
    * @function reset
    * @memberof Session
    */
    this.reset = function(){
        config = {
            MAX_RECORDED_SESSIONS_NUMBER: 2
        };
    }
    // apply default configuration
    sessionInstance.reset();

    /**
    * returns the internal configuration
    * @function getConfig
    * @memberof Session
    */
    this.getConfig = function(){
        return config;
    }

    /**
    * initializes the module with custom parameters
    * @function init
    * @memberof Session
    */
    this.init = function(params){
        Logger.info('GamifiveSDK', 'Session', 'init', params);

        // copy parameters into internal configuration
        for (var key in params){
            config[key] = params[key];
        }

        if (typeof config.moreGamesButtonStyle !== 'undefined'){
            Menu.setCustomStyle(config.moreGamesButtonStyle);
        }

        // allows starting a new session
        config.sessions = [];

        VHost.afterLoad(function(){

            Menu.init({
                goToHomeCallback: sessionInstance.goToHome
            });

            Menu.show();

        });

        VHost.load();
    }

    var getLastSession = function(){
        return config.sessions[0];
    }

    /**
    * starts a new gameplay session
    * @function start
    * @memberof Session
    */
    this.start = function(){
        Logger.info('GamifiveSDK', 'Session', 'start');

        // if init has been called, then config.session will be []
        if (typeof config.sessions !== typeof []){
            throw 'GamifiveSDK :: Session :: start :: init not called';
        }

        // if a previous session exists, it must have been ended
        if (config.sessions.length > 0 & typeof getLastSession().endTime === 'undefined'){
            throw 'GamifiveSDK :: Session :: start :: previous session not ended';     
        }

        // ok, you can start a new session
        config.sessions.unshift({
            startTime: new Date(),
            endTime: undefined,
            score: undefined,
            level: undefined
        });

        config.sessions = config.sessions.slice(0, config.MAX_RECORDED_SESSIONS_NUMBER);

        

        if (config.lite){

        } else {

        }

        if (typeof startCallback === 'function') {
            try {
                Menu.hide();
                startCallback();
            } catch (e){
                Logger.error('GamifiveSDK', 'startSession', 'error while trying to start a session', e);
                Menu.show();
            }
        }
    }

    /**
    * sets a callback function to be called when starting a gameplay session
    * @function onStart
    * @memberof Session
    */
    this.onStart = function(callback){
        Logger.info('GamifiveSDK', 'Session', 'onStart');

        if (typeof callback === 'function'){
            startCallback = callback;
        } else {
            throw 'GamifiveSDK :: session :: onStart :: invalid value \
                    for callback: expected function, got "' + typeof callback + '"';
        }
    }   

    /**
    * sets a callback function to be called when the game enters pause status
    * @function onPauseEnter
    * @memberof Session
    */
    this.onPauseEnter = function(callback){
        Logger.log('GamifiveSDK', 'Session', 'onPauseEnter');
        Menu.show();
    }

    /**
    * sets a callback function to be called when the game exits pause status
    * @function onPauseExit
    * @memberof Session
    */
    this.onPauseExit = function(callback){
        Logger.log('GamifiveSDK', 'Session', 'onPauseExit');
        Menu.hide();
    }

    /**
    * ends a session and (if not in lite mode) shows the platform's gameover screen
    * @function end
    * @memberof Session
    */
    this.end = function(data){
        Logger.info('GamifiveSDK', 'Session', 'end', data);

        if (config.sessions.length &lt; 1){
            throw 'GamifiveSDK :: Session :: end :: no sessions started';
        }

        if (typeof getLastSession().endTime !== 'undefined'){
            throw 'GamifiveSDK :: Session :: end :: session already ended';
        }

        getLastSession().endTime = new Date();

        if (typeof data.score !== 'undefined'){
            if (typeof data.score === 'number'){
                getLastSession().score = data.score;
            } else {
                throw 'GamifiveSDK :: Session :: end :: invalid type of score: \
                    expected number, got ' + typeof data.score;
            }
        }

        if (typeof data.level !== 'undefined'){
            if (typeof data.level === 'number'){
               getLastSession().level = data.level;
            } else {
                throw 'GamifiveSDK :: Session :: end :: invalid type of level: \
                    expected number, got ' + typeof data.level;
            }
        }

        Menu.show();
    }

    /**
    * returns to the main page of the webapp
    * @function goToHome
    * @memberof Session
    */
    this.goToHome = function(){
        Logger.info('GamifiveSDK', 'Session', 'goToHome');
        window.location.href = Location.getOrigin();
    }

};

module.exports = Session;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Namespaces</h3><ul><li><a href="Event.html">Event</a></li><li><a href="Facebook.html">Facebook</a></li><li><a href="GA.html">GA</a></li><li><a href="GameInfo.html">GameInfo</a></li><li><a href="Location.html">Location</a></li><li><a href="Menu.html">Menu</a></li><li><a href="Network.html">Network</a></li><li><a href="Newton.html">Newton</a></li><li><a href="Session.html">Session</a></li><li><a href="User.html">User</a></li><li><a href="VarCheck.html">VarCheck</a></li><li><a href="VHost.html">VHost</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Tue Apr 26 2016 14:10:56 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
